{"mono129":"0.0.1","title":"minesweeper","author":"igorec","width":"128","height":"128","palette":["#000000","#7f0000","#007f00","#7f7f00","#00007f","#7f007f","#007f7f","#c0c0c0","#808080","#ff0000","#00ff00","#ffff00","#0000ff","#ff00ff","#00ffff","#ffffff"],"chrW":8,"chrH":8,"lua":"\"--\\nfunction createField(w,h,mines,fill)\\n  local f={}\\n  \\n  --create field array\\n  for y=1,h do\\n    local l={}\\n    for x=1,w do\\n      l[x]=fill\\n    end\\n    f[y]=l\\n  end\\n  \\n  --put mines\\n  local a=mines\\n  \\n  while a>0 do\\n    local x=rand(1,w)\\n    local y=rand(1,h)\\n    if f[y][x]==0 then\\n      f[y][x]=1\\n      a=a-1\\n    end\\n  end\\n  \\n  return f\\nend\\n\\nfunction minesCount(f,x,y)\\n  local am=0\\n  \\n  for cy=-1,1 do\\n    for cx=-1,1 do\\n      if x+cx<#f[y]+1 and y+cy<#f+1 and\\n        x+cx>0 and y+cy>0\\n      then\\n        if f[y+cy][x+cx]==1 then am=am+1 end\\n      end\\n    end\\n  end\\n  \\n  return am\\nend\\n\\nfunction drawField(f,fo,ox,oy)\\n  --f - main field, fo - opened cells\\n  \\n  --table of number colors\\n  local nc={12,2,9,4,1,6,0,8}\\n  \\n  --loop trough field\\n  for y=1,#fo do\\n    for x=1,#fo[y] do\\n      \\n      local tx=(ox+x-1)*8\\n      local ty=(oy+y-1)*8\\n      \\n      if fo[y][x]==0 then --cell not opened\\n        rect(tx,ty,8,8,7)\\n        spr(0,tx,ty,8)\\n        spr(1,tx,ty,15)\\n      elseif fo[y][x]==1 then --cell opened\\n        rect(tx,ty,8,8,7)\\n        spr(0,tx,ty,8)\\n        if f[y][x]==1 then --oh no!!11 teh mine!!!!!!\\n          spr(11,tx,ty,0)\\n        else --show number of mines\\n          local mc=minesCount(f,x,y)\\n          if mc>0 then spr(1+mc,tx,ty,nc[mc]) end\\n        end\\n      elseif fo[y][x]==2 then --cell flagged\\n        rect(tx,ty,8,8,7)\\n        spr(0,tx,ty,8)\\n        spr(1,tx,ty,15)\\n        spr(12,tx,ty,9)\\n        spr(13,tx,ty,0)\\n      elseif fo[y][x]==3 then\\n        rect(tx,ty,8,8,7)\\n        spr(0,tx,ty,8)\\n        spr(11,tx,ty,0)\\n        spr(14,tx,ty,9)\\n      end\\n      \\n    end\\n  end\\nend\\n\\n--\\n\\nfunction _init()\\n  fldx=0\\n  fldy=0\\n  fldw=16\\n  fldh=15\\n  fldm=40\\n  fldf=fldm\\n  flddfm=0\\n  fldoc=0\\n  t=0\\n  timer=0\\n  game=1\\n  mb=0\\n  \\n  fldx=8-fldw/2\\n  fldy=8-floor(fldh/2)\\n  \\n  fld=createField(fldw,fldh,fldm,0)\\n  fldo=createField(fldw,fldh,0,0)\\n  \\n  drawField(fld,fldo,fldx,fldy)\\n  \\n  drawUI()\\nend\\n\\n--\\n\\nfunction flagCell(x,y)\\n  if fldo[y][x]==0 and fldf>0 then \\n    fldo[y][x]=2\\n    fldf=fldf-1\\n    if fld[y][x]==1 then flddfm=flddfm+1 end\\n  elseif fldo[y][x]==2 then\\n    fldo[y][x]=0\\n    fldf=fldf+1\\n    if fld[y][x]==1 then flddfm=flddfm-1 end\\n  end\\n  if flddfm==fldm then gameWin() end\\nend\\n\\nfunction gameOver()\\n  for y=1,fldh do\\n    for x=1,fldw do\\n      if fld[y][x]==1 and fldo[y][x]==0 then\\n        fldo[y][x]=1\\n      elseif fld[y][x]==0 and fldo[y][x]==2 then\\n        fldo[y][x]=3\\n      end\\n    end\\n  end\\n  \\n  game=0\\nend\\n\\nfunction gameWin()\\n  \\n  for y=1,fldh do\\n    for x=1,fldw do\\n      if fld[y][x]==0 then\\n        fldo[y][x]=1\\n      else\\n        fldo[y][x]=2\\n      end\\n    end\\n  end\\n  \\n  game=2\\nend\\n\\nfunction openCell(x,y)\\n  \\n  --if x/y is within range\\n  if x>0 and y>0 and x<fldw+1 and y<fldh+1 then\\n  \\n  --if cell is a mine\\n  if fld[y][x]==1 and fldo[y][x]==0 then\\n    if fldoc==0 then\\n      --regenerate field if the first cell is mine\\n      while fld[y][x]==1 do\\n        fld=createField(fldw,fldh,fldm,0)\\n      end\\n    else\\n      --game over\\n      gameOver()\\n    end\\n  end\\n  \\n  --open cell\\n  if fldo[y][x]==0 then\\n    fldo[y][x]=1\\n    fldoc=fldoc+1\\n    \\n    --flood fill the empty cells\\n    \\n    if minesCount(fld,x,y)==0 then\\n      openCell(x+1,y)\\n      openCell(x-1,y)\\n      openCell(x,y+1)\\n      openCell(x,y-1)\\n      openCell(x+1,y+1)\\n      openCell(x-1,y+1)\\n      openCell(x+1,y-1)\\n      openCell(x-1,y-1)\\n    end\\n\\n  end\\n  \\n  end\\nend\\n\\nfunction drawUI()\\n  rect(fldx*8,(fldy-1)*8,fldw*8,8,7)\\n  text(string.sub(\\\"00\\\",0,2-#(tostring(fldf)))..fldf,fldx*8,(fldy-1)*8,9,1)\\n  text(string.sub(\\\"000\\\",0,3-#(tostring(timer)))..timer,(fldx+fldw-3)*8,(fldy-1)*8,9,1)\\n  rect(fldx*8+floor(fldw/2)*8,(fldy-1)*8,8,8,0)\\n  if mb==1 and game==1 then\\n    spr(18,fldx*8+floor(fldw/2)*8,(fldy-1)*8,11)\\n  else\\n    spr(15+game,fldx*8+floor(fldw/2)*8,(fldy-1)*8,11)\\n  end\\nend\\n\\n--\\nfunction _input(e)\\n  \\n  if string.sub(e.type,0,5)==\\\"mouse\\\" then\\n    mb=e.button\\n  end\\n  \\n  if e.type==\\\"mousedown\\\"\\n    and col(e.x,e.y,1,1,\\n    fldx*8+1,fldy*8+1,\\n    fldw*8-1,fldh*8-1) \\n    and game==1\\n  then\\n    \\n    local mx=floor((e.x-fldx*8)/8+1)\\n    local my=floor((e.y-fldy*8)/8+1)\\n    \\n    if mb==1 then\\n      openCell(mx,my)\\n      drawField(fld,fldo,fldx,fldy)\\n      \\n    elseif mb==2 then\\n      flagCell(mx,my)\\n      drawField(fld,fldo,fldx,fldy)\\n    end\\n    \\n  end\\n  \\n  if e.type==\\\"mousedown\\\" and e.y<8 then\\n    _init()\\n  end\\n  \\n  if e.type==\\\"keydown\\\" and key('space') then _init() end\\n  \\nend\\n\\nfunction _update()\\n  t=t+1\\n  \\n  drawUI()\\n  \\n  if t%60==0 and game==1 then\\n    timer=timer+1\\n  end\\nend\\n\\nfunction _draw()\\n  \\nend\"","spr":["MTIwLDE1Niw5OSwxMDAsNCwxMzEsMjU1LDI1NSwyNiwxOTIsMTI4LDE5MywyMjQsMTMxLDEsMTYsMjUyLDk3LDE2OCw1NiwxOTUsOTksMTQ1LDExMiw2LDY2LDI0MywxNTYsMTY5LDk2LDE0NCwxNzcsMjAxLDU3LDI0MywxNDMsMTM1LDEzNSwyMjUsMjA3LDEyOSwzMSw2MCwzMiwxOTAsNjksMTk0LDEyOSwzMSwxMDMsMTI4LDI0NCwxNTksNTEsNjAsMTgsNiw5LDksNjQsMTE3LDEwMyw2NCw4LDY4LDIxNSwyNDAsNzIsMjAsNDgsNzYsMTc4LDEzNiwyNDksODcsOTksNDksMTM3LDEyOSwxOTUsMjI2LDEzNSw1LDcsMywyMCwxMTIsMjE2LDI1MiwxMTEsMTE0LDIwOSwxNiwyMDgsMTEyLDEwNSw5OCwxNjgsMjQ5LDU1LDEwNSwyMTAsMTg3LDE1NCwxNiw2LDE1NSwxODYsMjU1LDE4MywyNTUsMjIzLDc4LDE3OSwxNzcsMTY5LDEwNywxNTYsOSwxNjEsMTI5LDI1MiwyMzEsMTA1LDU0LDEyLDE2Myw5NiwyMCwxNDAsMTMwLDgxLDQ4LDEwLDcwLDE5Myw0MCwxNjAsMjUsMCwwLDcwLDQxLDYyLDI1Mg==",0,0,"MTIwLDE1NiwyMzcsODMsMTc3LDEwNiwyMjgsNDgsMTYsMTI1LDE0NCwzNCwxNDEsOCw0MSw5MywxNTIsMTI0LDE5NSwyMCw0MSw5Miw0NCwyNDcsNDUsOTgsNTcsNjgsMTAsMjEsMTc0LDE0MCwxMCwxMjcsNzIsNjIsMjI4LDIwMiw0Myw4NCwxNjksMTgsNDEsNjcsMTAsMTc5LDE4NCwxMTQsMjEsMTMwLDE3MSwxOTUsMTMzLDExMiw1MCw3OSw2MiwxODQsMjUxLDEyOCwxMDcsMTQsMjQ2LDIzNywxMjIsMTk5LDUxLDE1MCwyMjIsMTU1LDEyMSwyNDIsMiw4NywxNiwxOCwxMzAsOCw0LDIyMiwyNTEsMTU0LDEyMywxOTEsMjM1LDE5OSw2NywxOTgsMjQsMjA0LDM4LDY0LDIwMiwxNDEsMTg0LDEzMiwyMDYsMTE5LDE5NSwxNDgsNyw4OCwyNywyMzUsMTg2LDcwLDE3MiwxODEsMjEwLDY0LDE3NSw3MCwyMzksMSwxMTksMjUwLDYwLDU3LDE4LDc0LDgxLDE5NCwzLDYxLDMxLDE2MCwyNTIsMTcsMTksMjIwLDIyMCwyMjIsMTgxLDkzLDYzLDE5OSwxNDQsMTY3LDI0MiwxNTgsMywxMDAsMjEsNjksNjUsMjAwLDE2NiwxNzksMjQ5LDEzNiw3MCwyMzUsMjM3LDIwMSwyMzEsMjIxLDI0LDE0OCwxODQsMjUsMjMwLDE1NywxNDEsOTEsMjE0LDg4LDE3OCwxNjEsMTgwLDE3NCwyMDMsMjUyLDUwLDE0MiwxNjYsMjMzLDE1LDI0Miw0MiwxNzIsNjMsMTcwLDE3MSwxMzksMzQsMjUxLDE2Myw2MCwyNywyMDgsMTIzLDExMCwzNiwxMjcsMTk1LDEyMSwxOTksMTE2LDE4NSw5MiwxNjIsMjM0LDQzLDY1LDIwMSwyNSwxOTcsMTg1LDIwOSwxODUsMTMwLDE0NywxMzksNDksMTg2LDE5LDEzOCwxMTksMjA2LDI0OSwxMzAsMjUzLDI1MiwyMCwxNTgsMjA2LDI1MSwxNywyMzcsOTAsMTU5LDE5MSwxODQsMTExLDIwMCwxMTcsOTEsNzAsOTYsMjUxLDE4LDI0MCw5NiwxODAsNzcsMjM3LDEwMywxMTMsNjIsMTIwLDE4Myw5Niw4NSwxMjMsMjA2LDExMCw3MSwyNTAsMjE2LDk1LDgzLDc0LDcyLDIwMywxNzUsMjAzLDc1LDE2MiwxNDMsMTU0LDI0OSwxNzQsMjM0LDg5LDIyOSw4MywyNDksNjAsMTMzLDE4MiwyMzAsMTkzLDQ3LDE1NCwyMDcsOTMsMjAzLDU3LDEyNywyOCwxODgsMTg1LDE2MiwyOCw0OSw4LDExNiwyNDcsMjM1LDI1NCwxNjEsMTI0LDc0LDE2Miw4NCwxNjgsODUsOTMsMTgzLDIzMSwxMDMsNTcsMTY3LDI5LDE5MywxOCwxLDExMywyMzgsMTg3LDI0NiwyMzgsMjQ2LDM4LDUyLDY4LDE5MiwxODksMTc0LDI1NCwyMzUsMjE2LDYzLDE2NSwxMjIsNjcsNCw1MSwyMzQsMTg1LDIwNiw4NiwxOTksMTE5LDYzLDE1MywyMzEsNzIsMjU1LDE0MSwxNTAsMTgxLDIwNiwxODgsMTY4LDc5LDE1NywxODMsNDMsMjUxLDUsNiw1OCwxOTAsMjA1LDIxNCwxNSw3OCwyMzEsMTY0LDIxNywyMTIsMTExLDY0LDE2NSwxODMsMTI2LDE4Miw1Miw5NiwxNjksODUsMjE0LDEyOSwxMTksMjYsMTYwLDExMywyMjcsNCwxNDksMTQzLDYyLDEsMTksMjksODgsMTI3LDI0Myw2MSwwLDExMSwyMjIsODcsMjU0LDI1MCwyMjYsMjI1LDk0LDcwLDE0NSw3MSwyNDYsMjAwLDEwOSwxOTUsMTcsMywyMDcsMTUxLDYsMjQwLDkzLDE3Myw2LDI4LDExNywyMzcsNzEsMjA3LDI0OSw4OSwxOTAsMjMsMTgwLDM0LDE3OSw3MiwxMSwxMDksMTY2LDk0LDc2LDE4MCwxMzIsOTcsMjUwLDE1MSwyNTUsMTU0LDQzLDE3NCwxODQsMjI2LDEyNywxOTgsMjMsMjQ2LDE0OCwzMCwxNzY="],"sprflags":[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],"map":{"w":1,"h":1,"t":"MTIwLDE1Niw5OSwwLDAsMCwxLDAsMQ==","c":"MTIwLDE1Niw5OSwwLDAsMCwxLDAsMQ=="}}